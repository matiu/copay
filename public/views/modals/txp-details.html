<nav class="tab-bar">
  <section class="left-small">
    <a class="p10" 
      ng-click="cancel()"><i class="fi-arrow-left size-24"></i> 
    </a>
  </section>
</nav>
<div class="row p60t" ng-init="updateCopayerList()">
  <div class="large-12 columns">
    <div class="header-modal">
      <div class="ellipsis p10b size-16 m20r">
        <span class="tx-proposal size-12 m5r"> <i ng-class="{'active':_cache.pendingForUs}" class="fi-arrow-right"></i> </span>
        <span class="text-gray">
          <span translate>To:</span>
          <span ng-if="_cache.merchant">
            <span ng-show="_cache.merchant.pr.ca"><i class="fi-lock"></i> {{_cache.merchant.domain}}</span>
            <span ng-show="!_cache.merchant.pr.ca"><i class="fi-unlock"></i> {{_cache.merchant.domain}}</span>
          </span>
          <contact address="{{_cache.toAddress}}" ng-hide="_cache.merchant"></contact>
          {{_cache.toAddress}}
        </span>
      </div>

      <div class="p25l" ng-class="{'text-gray':!_cache.pendingForUs}">
        <div class="size-21 text-bold m5b">
          {{_cache.amountStr}}
        </div>
        <span class="alt-currency black size-12" ng-class="{'gray':!_cache.pendingForUs}">
          {{_cache.alternativeAmountStr}}
        </span>
      </div>
    </div>

    <div class="m10v line-b size-14" ng-show="_cache.message">
      <div class="oh" ng-if="_cache.ts || _cache.createdOn ">
        <p class="left m5b">{{_cache.creatorName}}</p>
        <div class="text-gray text-right m5t size-12">
          <time>{{ (_cache.ts || _cache.createdOn ) * 1000 | amTimeAgo}}</time>
        </div>
      </div>
      <div class="text-gray m10b">
        {{_cache.message}}
      </div>
    </div>

    <div class="m10v line-b size-14" ng-if="_cache.merchant">
      <div class="oh">
        <p class="left m5b" translate>Merchant Message:</p>
        <div class="text-gray text-right m5t size-12" ng-if="_cache.merchant && _cache.merchant.expirationDate">
          <span><i>Expires</i>: {{_cache.merchant.expirationDate | amTimeAgo }}</span>
        </div>
      </div>
      <div class="text-gray m10b">
        {{_cache.merchant.pr.pd.memo}}
      </div>
    </div>

    <div class="m10v" ng-if="tx.actions[0] && !txRejected && !txBroadcasted">
      <h3 translate>Signatures:</h3>
      <ul class="no-bullet size-10 m0">
        <li ng-repeat="ac in tx.actions">
        <i ng-if="ac.type == 'reject'" class="fi-x icon-sign x"></i>
        <i ng-if="ac.type == 'accept'" class="fi-check icon-sign check"></i>
        <i ng-if="!ac.type" class="fi-loop"></i> 
        {{ac.copayerId}} -- {{ac.copayerName}}
        </li>
      </ul>
    </div>

    <div class="box-notification" ng-show="error">
      <div class="box-icon error">
        <i class="fi-x size-24"></i>
      </div>
      <span class="text-warning size-14">
        {{error|translate}}
      </span>
    </div>

    <div class="row collapse" 
      ng-init="hideSign = false; hideReject = false"
      ng-show="tx.pendingForUs && !txBroadcasted && !txRejected">
      <div class="large-5 medium-5 small-5 columns">
        <button class="button warning m0 expand" ng-click="hideTxInfo = true; hideSign = true; reject(_cache);" 
          ng-disabled="loading" ng-show="!hideReject">
          <i class="fi-x icon-sign x"></i>  
          <span translate>Reject</span>
        </button>
      </div>
      <div class="large-5 medium-5 small-5 columns text-right">
        <button class="button primary m0 expand" ng-click="hideTxInfo = true; hideReject = true; sign(_cache)" 
          ng-disabled="loading" ng-show="!hideSign">
          <i class="fi-check icon-sign check"></i>  
          <span translate>Sign</span>
        </button>
      </div>
    </div>

    <div ng-show="!hideTxInfo">
      <div class="row collapse m10t" 
        ng-show="tx.status=='accepted' && !txBroadcasted && !txRejected">
        <button class="primary expand"
          ng-click="broadcast(_cache)"
          ng-disabled="loading"> <i class="fi-upload-cloud"></i>
          <span translate>Broadcast Transaction</span>
        </button>
      </div>
      <div class="text-success m10t oh" 
        ng-show="txBroadcasted">
        <span translate>Transaction sent!</span>
      </div>
      <div class="text-center text-warning"
        ng-show="txRejected" translate>
        Transaction finally rejected
      </div>
    </div>
  </div>
</div>
<div class="extra-margin-bottom"></div>
